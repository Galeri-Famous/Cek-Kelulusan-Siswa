<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cek Kelulusan Siswa Madrasah</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 text-gray-800">

  <header class="bg-green-700 text-white p-6 text-center">
    <h1 class="text-2xl font-bold">Cek Kelulusan Siswa Madrasah Tahun 2025</h1>
  </header>

  <main class="p-6 max-w-2xl mx-auto">
    <div class="text-center mb-6">
      <img src="logo-madrasah.png" alt="Logo Madrasah" class="h-24 mx-auto mb-2" />
      <h2 class="text-2xl font-bold">MI ASY-SYAFI’IYYAH 02 JATIBARANG</h2>
    </div>
    <h3 class="text-xl font-semibold mb-4">Masukkan Nama Siswa</h3>
    <input
      id="searchInput"
      type="text"
      placeholder="Contoh: LESMANA YUNIARTI"
      class="w-full p-3 border border-gray-300 rounded mb-4"
    />
    <button
      onclick="searchStudent()"
      class="w-full bg-green-600 text-white font-bold py-2 rounded hover:bg-green-700"
    >
      Cari
    </button>
    <div id="result" class="mt-6"></div>
  </main>

  <footer
    class="bg-green-800 text-white text-center p-6 mt-12"
  >
    <p class="mb-2">
      MI ASY-SYAFI’IYYAH 02 JATIBARANG | Jl. KH. Abdul Wahab Sya'roni No.18,
      Jatibarang Lor, Kec. Jatibarang, Kab. Brebes
    </p>
    <p class="mb-2">Kontak: 0857-4752-0003</p>
    <div class="flex justify-center space-x-4 mt-2">
      <a href="https://www.facebook.com/profile.php?id=100067341316800&locale=id_ID" target="_blank"
        ><img src="facebook-icon.png" alt="Facebook" class="h-6 w-6 inline" />
      </a>
      <a href="https://www.instagram.com/mediamisyada?igsh=MWN2NWwzNWdiZmRncg==" target="_blank"
        ><img src="instagram-icon.png" alt="Instagram" class="h-6 w-6 inline" />
      </a>
      <a href="https://www.tiktok.com/@mediamisyada" target="_blank"
        ><img src="tiktok-icon.png" alt="TikTok" class="h-6 w-6 inline" />
      </a>
    </div>
    <p class="mt-4">&copy; 2025 MI ASY-SYAFI’IYYAH 02 JATIBARANG</p>
  </footer>

  <script>
    const spreadsheetId = "12ECnsz-sA9iHH9jSyV-fSNXMsL6Sn-PTZJgg8gElcb0";
    const apiKey = "AIzaSyCWathz0NssmvXm0xBgm_ql7CpfU7Dg_dU";
    const sheetName = "Sheet1"; // Ganti jika nama sheet Anda berbeda

    let studentsData = [];

    // Ambil data dari Google Sheets saat halaman dimuat
    async function loadSheetData() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}?key=${apiKey}`;
      try {
        const response = await fetch(url);
        const data = await response.json();
        if (data.values && data.values.length > 0) {
          studentsData = data.values; // data array 2D
          console.log("Data siswa berhasil di-load:", studentsData);
        } else {
          console.error("Sheet kosong atau tidak ditemukan data.");
        }
      } catch (error) {
        console.error("Gagal mengambil data dari Google Sheets:", error);
      }
    }

    function searchStudent() {
      const input = document.getElementById("searchInput").value.trim().toUpperCase();
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "";

      if (studentsData.length === 0) {
        resultDiv.innerHTML = `<p class="text-red-600 font-semibold">Data belum dimuat, silakan coba refresh halaman.</p>`;
        return;
      }

      // Baris pertama adalah header, cari mulai dari baris 1
      const data = studentsData.find((row, index) => {
        if (index === 0) return false; // skip header
        return row[0].toUpperCase() === input;
      });

      if (data) {
        const status = data[1] || "-";
        const sklLink = data[2] || "";
        const boxColor = status === "LULUS" ? "bg-green-500" : "bg-red-500";

        resultDiv.innerHTML = `
          <div class="text-center">
            <div class="${boxColor} text-white text-2xl font-bold py-4 px-6 rounded shadow mb-4">
              ${status}
            </div>
            ${
              sklLink
                ? `<a href="${sklLink}" target="_blank" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded" download>Download SKL</a>`
                : `<p class="text-gray-600 italic">Link SKL tidak tersedia.</p>`
            }
          </div>
        `;
      } else {
        resultDiv.innerHTML = `<p class="text-red-600 font-semibold">Data tidak ditemukan.</p>`;
      }
    }

    // Muat data saat halaman siap
    window.onload = loadSheetData;
  </script>
</body>
</html>
